<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bitki TanÄ±ma</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  text-align:center;
  padding:20px;
}

video, img{
  width:100%;
  max-width:320px;
  border-radius:12px;
  margin-top:10px;
}

button{
  padding:10px 16px;
  border:none;
  border-radius:10px;
  background:#4CAF50;
  color:white;
  font-size:16px;
  margin:6px;
  cursor:pointer;
}

#result{
  background:white;
  border-radius:12px;
  padding:15px;
  margin-top:15px;
  display:none;
}

.copy{
  background:#2196F3;
}
</style>
</head>

<body>

<h2>ðŸŒ± Bitki TanÄ±ma</h2>

<video id="camera" autoplay playsinline></video><br>
<button onclick="takePhoto()">ðŸ“¸ FotoÄŸraf Ã‡ek</button>

<br><br>
<input type="file" accept="image/*" onchange="loadFile(event)">

<canvas id="canvas" style="display:none"></canvas>
<img id="preview">

<div id="result">
  <img id="plantImage">
  <p id="plantText"></p>
  <button class="copy" onclick="copyPlants()">Bitkilerin isimlerini kopyala</button>
</div>

<script>
  const video = document.getElementById("camera");
const canvas = document.getElementById("canvas");
const preview = document.getElementById("preview");
const resultBox = document.getElementById("result");
const plantText = document.getElementById("plantText");
const plantImage = document.getElementById("plantImage");

let detectedPlants = "";

// Kamera aÃ§
navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => video.srcObject = stream)
.catch(() => alert("Kamera izni verilmedi"));

// Kamera fotoÄŸraf Ã§ek
function takePhoto(){
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);
  preview.src = canvas.toDataURL("image/png");
  detectPlant(preview.src);
}

// Dosya seÃ§me
function loadFile(e){
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    preview.src = reader.result;
    detectPlant(reader.result);
  };
  reader.readAsDataURL(file);
}

// Yapay zekÃ¢ tanÄ±ma
async function detectPlant(imageBase64){
  resultBox.style.display = "none";
  plantText.innerText = "TanÄ±nÄ±yor...";

  const response = await fetch("https://api.plant.id/v2/identify",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Api-Key":"BURAYA_API_KEY"
    },
    body: JSON.stringify({
      images:[imageBase64],
      modifiers:["crops_fast"],
      plant_language:"tr"
    })
  });

  const data = await response.json();

  if(!data.suggestions || data.suggestions.length === 0){
    showNoPlant();
    return;
  }

  const names = data.suggestions.slice(0,3).map(p=>p.plant_name);
  detectedPlants = names.join(" ");

  plantImage.src = preview.src;
  plantText.innerText =
    "Bu resimde,\n" + names.join(", ") + " var.";

  resultBox.style.display = "block";
}

// Bitki yoksa
function showNoPlant(){
  resultBox.style.display = "block";
  plantText.innerText = ":(\nBitki bulunamadÄ±.";
  detectedPlants = "";
}

// Kopyala
function copyPlants(){
  if(!detectedPlants) return;
  navigator.clipboard.writeText(detectedPlants);
  alert("KopyalandÄ±: " + detectedPlants);
}
</script>
</body>
</html>
